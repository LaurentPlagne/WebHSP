<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydro Valley Visualizer</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        #mynetwork {
            width: 100%;
            height: 800px;
            border: 1px solid lightgray;
        }
        body {
            font-family: sans-serif;
            background-color: #f7f7f7;
        }
    </style>
</head>
<body>

<h1>Hydro Valley Visualizer</h1>
<p>This visualization shows the connections between reservoirs and units (turbines/pumps) in the hydro valley.</p>
<div id="mynetwork"></div>

<script type="text/javascript">
    async function drawValley() {
        // 1. Fetch the data from the JSON file
        const response = await fetch('hydro_valley_instance.json');
        const valleyData = await response.json();

        // 2. Create nodes for reservoirs
        const reservoirs = valleyData.reservoirs;
        const nodes = new vis.DataSet(reservoirs.map(r => ({
            id: r.name,
            label: r.name,
            shape: 'box',
            color: '#97C2FC' // Light blue
        })));

        // 3. Create edges for units (turbines/pumps)
        const units = valleyData.units;
        const edges = new vis.DataSet(units.map(u => ({
            from: u.upstream_reservoir,
            to: u.downstream_reservoir,
            label: `${u.name} (${u.type})`,
            arrows: 'to',
            color: u.type === 'turbine' ? '#4CAF50' : '#F44336', // Green for turbine, red for pump
            font: { align: 'top' }
        })));

        // 4. Create a network
        const container = document.getElementById('mynetwork');
        const data = {
            nodes: nodes,
            edges: edges
        };
        const options = {
            layout: {
                hierarchical: {
                    enabled: true,
                    direction: 'UD', // Up-Down layout
                    sortMethod: 'directed'
                }
            },
            physics: {
                enabled: false // Disable physics for hierarchical layout
            },
            edges: {
                smooth: true
            }
        };
        const network = new vis.Network(container, data, options);
    }

    drawValley();
</script>

</body>
</html>
